registry:
  restart: always
  image: registry:latest
#  ports:
#    - ${PORT}:5000
  tty: true
  stdin_open: true
  environment:
    REGISTRY_HTTP_TLS_CERTIFICATE: /certs/domain.crt
    REGISTRY_HTTP_TLS_KEY: /certs/domain.key
    REGISTRY_AUTH: htpasswd
    REGISTRY_AUTH_HTPASSWD_PATH: /auth/htpasswd
    REGISTRY_AUTH_HTPASSWD_REALM: Registry Realm
  volumes_from:
  - registry-datavolume
#  volumes:
#    - /path/data:/var/lib/registry
#    - /path/certs:/certs
#    - /path/auth:/auth
  labels:
    io.rancher.container.pull_image: always
    io.rancher.sidekicks: registry-datavolume
    io.rancher.container.hostname_override: container_name

registry-datavolume:
  labels:
    io.rancher.container.start_once: 'true'
    io.rancher.container.hostname_override: container_name
  entrypoint:
  - /bin/true
  image: busybox
  volumes:
  - /data/registy
  net: none

registry-frontend:
  restart: always
  image: konradkleine/docker-registry-frontend:v2
  ports:
    - ${PORT}:80
  tty: true
  stdin_open: true
  environment:
    ENV_DOCKER_REGISTRY_HOST: registry
    ENV_DOCKER_REGISTRY_PORT: 5000
    ENV_DOCKER_REGISTRY_USE_SSL: 0
#    ENV_REGISTRY_PROXY_FQDN: ENTER-YOUR-APPLICATION-HOST-HERE
#    ENV_REGISTRY_PROXY_PORT: ENTER-PORT-TO-YOUR-APPLICATION-HOST-HERE
    ENV_DEFAULT_REPOSITORIES_PER_PAGE: 50
    ENV_DEFAULT_TAGS_PER_PAGE: 10
  links:
  - registry:registry
  labels:
    io.rancher.container.pull_image: always
    io.rancher.sidekicks: registry
    io.rancher.container.hostname_override: container_name
